<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Favoritos - Crowdfunding</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="container">
      <a href="index.html" class="logo">Crowdfunding</a>
      <nav id="mainNav"></nav>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="flex items-center gap-3 mb-6">
        <span style="font-size: 32px;">‚ù§Ô∏è</span>
        <div>
          <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 4px;">Proyectos Favoritos</h1>
          <p class="text-muted">Los proyectos que has guardado para seguir de cerca</p>
        </div>
      </div>

      <div class="card mb-6">
        <div class="card-content">
          <div class="grid grid-cols-3 gap-4 text-center">
            <div>
              <div style="font-size: 24px; font-weight: 700;" id="favCount">0</div>
              <div class="text-sm text-muted">Proyectos Favoritos</div>
            </div>
            <div>
              <div style="font-size: 24px; font-weight: 700;" id="activeCount">0</div>
              <div class="text-sm text-muted">Activos</div>
            </div>
            <div>
              <div style="font-size: 24px; font-weight: 700;" id="totalRaised">$0</div>
              <div class="text-sm text-muted">Total Recaudado</div>
            </div>
          </div>
        </div>
      </div>

      <div id="favoritesGrid" class="grid grid-cols-3 gap-6"></div>

      <div id="emptyState" class="card hidden">
        <div class="card-content text-center" style="padding: 80px 20px;">
          <div style="font-size: 64px; margin-bottom: 16px;">‚ù§Ô∏è</div>
          <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No tienes proyectos favoritos</h3>
          <p class="text-muted mb-6">Explora proyectos y marca como favoritos aquellos que te interesen para seguir su progreso.</p>
          <a href="projects.html" class="btn btn-primary">üîç Explorar Proyectos</a>
        </div>
      </div>

      <div class="text-center mt-6" id="moreButton" style="display: none;">
        <a href="projects.html" class="btn btn-outline">üîç Descubrir M√°s Proyectos</a>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2024 Crowdfunding Platform. Todos los derechos reservados.</p>
    </div>
  </footer>

  <script src="data.js"></script>
  <script>
  (function(){ if (typeof window.updateNavigation === 'function') return; 
  if (typeof window.logout !== 'function') window.logout = function(){};
    function _getNavUser(){ if (typeof getCurrentUser === 'function'){ try{ const u = getCurrentUser(); if (u) return u; }catch(e){} } return { name: 'Usuario Demo', email: 'demo@ejemplo.com', role: 'user' }; }
    window.updateNavigation = function(){ const nav = document.getElementById('mainNav'); if (!nav) return; const user = _getNavUser(); if (!user){ nav.innerHTML = `<a href="index.html">Inicio</a><a href="projects.html">Proyectos</a><a href="login.html" class="btn btn-primary">Iniciar Sesi√≥n</a>`; } else if (user.role === 'admin'){ nav.innerHTML = `<a href="index.html">Inicio</a><a href="projects.html">Proyectos</a><a href="admin-projects.html">Gesti√≥n Proyectos</a><a href="admin-users.html">Gesti√≥n Usuarios</a><div class="user-menu"><button class="btn btn-outline" onclick="toggleUserMenu()">${user.name} ‚ñº</button><div class="dropdown-menu" id="userDropdown"><span class="dropdown-item" style="font-weight: 600; cursor: default;">Administrador</span><div class="separator" style="margin: 8px 0;"></div><a href="favorites.html" class="dropdown-item">Favoritos</a><a href="my-donations.html" class="dropdown-item">Mis Aportes</a><div class="separator" style="margin: 8px 0;"></div><span class="dropdown-item" onclick="logout()">Cerrar Sesi√≥n</span></div></div>`; } else { nav.innerHTML = `<a href="index.html">Inicio</a><a href="projects.html">Proyectos</a><a href="my-projects.html">Mis Proyectos</a><div class="user-menu"><button class="btn btn-outline" onclick="toggleUserMenu()">${user.name} ‚ñº</button><div class="dropdown-menu" id="userDropdown"><span class="dropdown-item" style="font-weight: 600; cursor: default;">${user.email}</span><div class="separator" style="margin: 8px 0;"></div><a href="my-projects.html" class="dropdown-item">Mis Proyectos</a><a href="my-donations.html" class="dropdown-item">Mis Aportes</a><a href="favorites.html" class="dropdown-item">Favoritos</a><div class="separator" style="margin: 8px 0;"></div><span class="dropdown-item" onclick="logout()">Cerrar Sesi√≥n</span></div></div>`; } };
    window.toggleUserMenu = function(){ const dropdown = document.getElementById('userDropdown'); if (dropdown) dropdown.classList.toggle('active'); };
    document.addEventListener('click', function(e){ const userMenu = document.querySelector('.user-menu'); const dropdown = document.getElementById('userDropdown'); if (userMenu && dropdown && !userMenu.contains(e.target)) dropdown.classList.remove('active'); });
    window.toggleFavorite = function(projectId){ if (!Array.isArray(window.projects)) return; const p = projects.find(p=>p.id===projectId); if (p) p.isFavorite = !p.isFavorite; };
    window.formatDate = function(dateString){ try{ const d = new Date(dateString); return d.toLocaleDateString('es-ES',{ year: 'numeric', month: 'long', day: 'numeric' }); }catch(e){ return dateString; } };
    window.getDaysLeft = function(deadlineString){ try{ const deadline = new Date(deadlineString); const today = new Date(); const diffTime = deadline - today; return Math.ceil(diffTime/(1000*60*60*24)); }catch(e){ return 0; } };
    window.getStatusBadge = function(status){ const statusMap = { draft: { label: 'Borrador', class: 'badge-secondary' }, under_review: { label: 'En Revisi√≥n', class: 'badge-primary' }, published: { label: 'Publicado', class: 'badge-success' }, observed: { label: 'Observado', class: 'badge-warning' }, rejected: { label: 'Rechazado', class: 'badge-destructive' } }; const info = statusMap[status] || { label: status, class: 'badge-secondary' }; return `<span class="badge ${info.class}">${info.label}</span>`; };
    window.getCampaignStatusBadge = function(status){ const statusMap = { not_started: { label: 'No Iniciada', class: 'badge-secondary' }, in_progress: { label: 'En Progreso', class: 'badge-success' }, paused: { label: 'En Pausa', class: 'badge-warning' }, finished: { label: 'Finalizada', class: 'badge-secondary' } }; const info = statusMap[status] || { label: status, class: 'badge-secondary' }; return `<span class="badge ${info.class}">${info.label}</span>`; };
    window.requireAuth = function(){ return true; };
    window.requireAdmin = function(){ return true; };
  })();
  </script>
  <script>
    function initPage() {
      if (!requireAuth()) return;
      updateNavigation();
      loadFavorites();
    }

    function loadFavorites() {
      const favorites = projects.filter(p => p.isFavorite && p.status === 'published');

      document.getElementById('favCount').textContent = favorites.length;
      document.getElementById('activeCount').textContent = favorites.filter(p => p.campaignStatus === 'in_progress').length;
      
      const totalRaised = favorites.reduce((sum, p) => sum + p.currentAmount, 0);
      document.getElementById('totalRaised').textContent = '$' + totalRaised.toLocaleString();

      const grid = document.getElementById('favoritesGrid');
      const emptyState = document.getElementById('emptyState');
      const moreButton = document.getElementById('moreButton');

      if (favorites.length === 0) {
        grid.innerHTML = '';
        emptyState.classList.remove('hidden');
        moreButton.style.display = 'none';
        return;
      }

      emptyState.classList.add('hidden');
      moreButton.style.display = 'block';
      
      grid.innerHTML = favorites.map(project => {
        const progress = (project.currentAmount / project.fundingGoal * 100).toFixed(0);
        const daysLeft = getDaysLeft(project.deadline);

        return `
          <div class="project-card">
            <img src="${project.image}" alt="${project.title}" class="project-image">
            <div class="project-body">
              <div class="project-category">
                <span class="badge badge-outline">${project.category}</span>
                <button class="btn btn-sm" onclick="toggleProjectFavorite('${project.id}')" style="float: right; padding: 4px 8px; border: none; background: none; cursor: pointer;">
                  ‚ù§Ô∏è
                </button>
              </div>
              <h3 class="project-title">${project.title}</h3>
              <p class="project-description">${project.description}</p>
              <div class="progress mt-4">
                <div class="progress-bar" style="width: ${progress}%"></div>
              </div>
              <div class="flex justify-between text-sm mt-2">
                <span style="font-weight: 600; color: var(--primary);">$${project.currentAmount.toLocaleString()}</span>
                <span class="text-muted">${progress}% financiado</span>
              </div>
              <div class="flex justify-between text-sm mt-2">
                <span class="text-muted">Meta: $${project.fundingGoal.toLocaleString()}</span>
                <span class="text-muted">${daysLeft > 0 ? daysLeft + ' d√≠as' : 'Finalizado'}</span>
              </div>
              <a href="project-detail.html?id=${project.id}" class="btn btn-primary w-full mt-4">Ver Detalles</a>
            </div>
          </div>
        `;
      }).join('');
    }

    function toggleProjectFavorite(projectId) {
      toggleFavorite(projectId);
      loadFavorites();
    }

    initPage();
  </script>
</body>
</html>
